# 智能报销Agent

智能报销Agent是一个基于大语言模型的智能助手，用于简化和自动化差旅报销流程。通过文字交互，用户可以方便地录入行程、上传发票、生成报销单，并提交到NCC系统。

## 功能特点

- **全流程覆盖**：支持从行程录入到NCC提交的完整报销流程
- **智能对话**：基于大语言模型的自然语言交互，让报销体验更加简单直观
- **发票识别**：支持多种类型发票的自动识别和信息提取
- **自动匹配**：智能匹配行程和发票，检查票据完整性
- **报销类型自动判断**：根据出差地点自动判断报销类型（北上、广深、杭夏、港澳台等）
- **Web界面**：提供友好直观的Web交互界面，支持表单操作和对话操作

## 系统架构

项目基于Python和Qwen-Agent框架开发，使用通义千问大语言模型作为核心，架构清晰简洁：

```
智能报销Agent
├── app.py                    # Streamlit Web应用入口
├── test3_all.py              # rpa操作
├── utils_1.py                # 实现rpa操作的工具包文件
├── config.py                 # 全局配置
├── main.py                   # 命令行程序入口
├── requirements.txt          # 依赖包列表
├── tools/                    # 工具模块
│   ├── __init__.py           # 工具包初始化
│   ├── trip_recorder.py      # 行程录入工具
│   ├── invoice_processor.py  # 发票处理工具
│   ├── reimbursement_generator.py  # 报销单生成工具
│   ├── ncc_submission.py     # NCC提交工具
│   └── invoice_image_processor.py  # 发票图像处理工具
└── utils/                    # 辅助功能
    ├── __init__.py           # 辅助包初始化
    └── helpers.py            # 辅助函数集合
```

## 安装与配置

### 环境要求

- Python 3.10
- 通义千问API密钥（或其他兼容OpenAI接口的大模型服务）

### 安装步骤

1. 克隆本仓库
```bash
git clone https://github.com/your-username/reimbursement-agent.git
cd reimbursement-agent
```

2. 安装依赖
```bash
pip install -r requirements.txt
```

3. 配置环境变量
将`.env.example`复制为`.env`，并填入相关API密钥和配置信息：
```bash
cp .env.example .env
# 编辑.env文件填入API密钥等信息
```

## 使用方法

### 命令行模式

运行命令行程序：
```bash
python main.py
```

### Web界面模式

运行Streamlit Web应用：
```bash
streamlit run app.py
```

启动后，会自动打开浏览器访问Web界面（通常是http://localhost:8501）。

Web界面提供了两种交互方式：
1. **聊天对话**：与智能助手自然对话，完成报销流程
2. **表单操作**：使用结构化表单直接录入行程、上传发票等信息

#### Web界面特点：

- **直观的进度显示**：侧边栏显示当前报销进度和状态
- **表单式数据录入**：提供结构化表单，方便快速录入行程和发票信息
- **发票文件上传**：支持直接上传各种格式的发票文件
- **数据实时预览**：显示已添加的行程和发票信息
- **报销单可视化**：直观展示生成的报销单和费用明细
- **交互式确认流程**：提供明确的信息确认步骤

示例对话：

```
用户请求: 你好，我想报销一次出差费用

助手回应: 您好！很高兴为您提供差旅报销服务。我可以帮您完成从行程录入到NCC系统提交的全流程。

首先，请告诉我您的出差行程信息，包括：
- 出发日期
- 到达日期
- 出发地点
- 到达地点
- 出差事由
- 交通工具

您可以一次性提供以上信息，也可以分步输入，我会引导您完成。您也可以直接使用页面上的"行程录入表单"进行填写。

用户请求: 我6月15日从上海出发去北京，6月17日返回，坐高铁，出差事由是参加技术交流会

助手回应: 好的，我已记录您的行程信息：

| 出发日期   | 到达日期   | 出差天数 | 出发地点 | 到达地点 | 交通工具 | 出差事由       |
|------------|------------|----------|----------|----------|----------|----------------|
| 2023-06-15 | 2023-06-17 | 3        | 上海     | 北京     | 高铁     | 参加技术交流会 |

现在，请上传您的发票。您可以使用"发票上传"表单，也可以告诉我发票类型和相关信息。
```

## 支持的发票类型

- 火车票/机票/汽车票
- 打车票
- 酒店住宿发票
- 餐票
- 高速通行票

## 开发扩展

如果您需要扩展系统功能，可以：

1. 在`tools/`目录下添加新的工具类
2. 在`config.py`的`TOOLS`列表中注册新工具
3. 更新`SYSTEM_INSTRUCTION`以告知AI新的功能
4. 如需扩展Web界面，可在`app.py`中添加相应的表单和处理逻辑

## 许可证

本项目采用MIT许可证，详情请参阅LICENSE文件。 